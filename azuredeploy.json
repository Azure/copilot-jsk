{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "metadata": {
      "_generator": {
        "name": "bicep",
        "version": "0.26.54.24096",
        "templateHash": "402407021432830548"
      },
      "name": "Azure OpenAI Studio Deployment",
      "description": "Azure OpenAI Studio Deployment"
    },
    "parameters": {
      "aiHubName": {
        "type": "string",
        "defaultValue": "air6-demo",
        "minLength": 2,
        "maxLength": 12,
        "metadata": {
          "description": "Optional. Name for the AI resource and used to derive name of dependent resources."
        }
      },
      "aiProjectName": {
        "type": "string",
        "defaultValue": "aitest-pjct",
        "minLength": 2,
        "maxLength": 12,
        "metadata": {
          "description": "Optional. Name for the AI resource and used to derive name of dependent resources."
        }
      },
      "aiHubFriendlyName": {
        "type": "string",
        "defaultValue": "Demo AI resource",
        "metadata": {
          "description": "Optional. Friendly name for your Azure AI resource"
        }
      },
      "aiHubDescription": {
        "type": "string",
        "defaultValue": "This is an example AI resource for use in Azure AI Studio.",
        "metadata": {
          "description": "Optional. Description of your Azure AI resource dispayed in AI studio"
        }
      },
      "aiProjectDescription": {
        "type": "string",
        "defaultValue": "This is an example AI project for.",
        "metadata": {
          "description": "Optional. Description of your Azure AI resource dispayed in AI studio"
        }
      },
      "aiProjectFriendlyName": {
        "type": "string",
        "defaultValue": "DemoProject AI resource",
        "metadata": {
          "description": "Optional. Friendly name for your Azure AI resource"
        }
      },
      "location": {
        "type": "string",
        "defaultValue": "[resourceGroup().location]",
        "metadata": {
          "description": "Optional. Location for all resources."
        }
      },
      "tags": {
        "type": "object",
        "defaultValue": {},
        "metadata": {
          "description": "Optional. Set of tags to apply to all resources."
        }
      },
      "computeInstanceName": {
        "type": "string",
        "defaultValue": "",
        "metadata": {
          "description": "Optional. Compute instance name."
        }
      }
    },
    "variables": {
      "name": "[toLower(format('{0}', parameters('aiHubName')))]",
      "uniqueSuffix": "[substring(uniqueString(resourceGroup().id), 0, 4)]"
    },
    "resources": [
      {
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2022-09-01",
        "name": "[format('dependencies-{0}-{1}-deployment', variables('name'), variables('uniqueSuffix'))]",
        "properties": {
          "expressionEvaluationOptions": {
            "scope": "inner"
          },
          "mode": "Incremental",
          "parameters": {
            "location": {
              "value": "[parameters('location')]"
            },
            "storageName": {
              "value": "[format('st{0}{1}', variables('name'), variables('uniqueSuffix'))]"
            },
            "keyvaultName": {
              "value": "[format('kv-{0}-{1}', variables('name'), variables('uniqueSuffix'))]"
            },
            "applicationInsightsName": {
              "value": "[format('appi-{0}-{1}', variables('name'), variables('uniqueSuffix'))]"
            },
            "containerRegistryName": {
              "value": "[format('cr{0}{1}', variables('name'), variables('uniqueSuffix'))]"
            },
            "aiServicesName": {
              "value": "[format('ais{0}{1}', variables('name'), variables('uniqueSuffix'))]"
            },
            "tags": {
              "value": "[parameters('tags')]"
            }
          },
          "template": {
            "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
            "contentVersion": "1.0.0.0",
            "metadata": {
              "_generator": {
                "name": "bicep",
                "version": "0.26.54.24096",
                "templateHash": "10210366753921432643"
              }
            },
            "parameters": {
              "location": {
                "type": "string",
                "defaultValue": "[resourceGroup().location]",
                "metadata": {
                  "description": "Azure region of the deployment"
                }
              },
              "tags": {
                "type": "object",
                "defaultValue": {},
                "metadata": {
                  "description": "Tags to add to the resources"
                }
              },
              "aiServicesName": {
                "type": "string",
                "metadata": {
                  "description": "AI services name"
                }
              },
              "applicationInsightsName": {
                "type": "string",
                "metadata": {
                  "description": "Application Insights resource name"
                }
              },
              "containerRegistryName": {
                "type": "string",
                "metadata": {
                  "description": "Container registry name"
                }
              },
              "keyvaultName": {
                "type": "string",
                "metadata": {
                  "description": "The name of the Key Vault"
                }
              },
              "storageName": {
                "type": "string",
                "metadata": {
                  "description": "Name of the storage account"
                }
              },
              "storageSkuName": {
                "type": "string",
                "defaultValue": "Standard_LRS",
                "allowedValues": [
                  "Standard_LRS",
                  "Standard_ZRS",
                  "Standard_GRS",
                  "Standard_GZRS",
                  "Standard_RAGRS",
                  "Standard_RAGZRS",
                  "Premium_LRS",
                  "Premium_ZRS"
                ],
                "metadata": {
                  "description": "Storage SKU"
                }
              }
            },
            "variables": {
              "containerRegistryNameCleaned": "[replace(parameters('containerRegistryName'), '-', '')]",
              "storageNameCleaned": "[replace(parameters('storageName'), '-', '')]"
            },
            "resources": [
              {
                "type": "Microsoft.Insights/components",
                "apiVersion": "2020-02-02",
                "name": "[parameters('applicationInsightsName')]",
                "location": "[parameters('location')]",
                "tags": "[parameters('tags')]",
                "kind": "web",
                "properties": {
                  "Application_Type": "web",
                  "DisableIpMasking": false,
                  "DisableLocalAuth": false,
                  "Flow_Type": "Bluefield",
                  "ForceCustomerStorageForProfiler": false,
                  "ImmediatePurgeDataOn30Days": true,
                  "IngestionMode": "ApplicationInsights",
                  "publicNetworkAccessForIngestion": "Enabled",
                  "publicNetworkAccessForQuery": "Disabled",
                  "Request_Source": "rest"
                }
              },
              {
                "type": "Microsoft.ContainerRegistry/registries",
                "apiVersion": "2021-09-01",
                "name": "[variables('containerRegistryNameCleaned')]",
                "location": "[parameters('location')]",
                "tags": "[parameters('tags')]",
                "sku": {
                  "name": "Premium"
                },
                "properties": {
                  "adminUserEnabled": true,
                  "dataEndpointEnabled": false,
                  "networkRuleBypassOptions": "AzureServices",
                  "networkRuleSet": {
                    "defaultAction": "Deny"
                  },
                  "policies": {
                    "quarantinePolicy": {
                      "status": "enabled"
                    },
                    "retentionPolicy": {
                      "status": "enabled",
                      "days": 7
                    },
                    "trustPolicy": {
                      "status": "disabled",
                      "type": "Notary"
                    }
                  },
                  "publicNetworkAccess": "Disabled",
                  "zoneRedundancy": "Disabled"
                }
              },
              {
                "type": "Microsoft.KeyVault/vaults",
                "apiVersion": "2022-07-01",
                "name": "[parameters('keyvaultName')]",
                "location": "[parameters('location')]",
                "tags": "[parameters('tags')]",
                "properties": {
                  "createMode": "default",
                  "enabledForDeployment": false,
                  "enabledForDiskEncryption": false,
                  "enabledForTemplateDeployment": false,
                  "enableSoftDelete": true,
                  "enableRbacAuthorization": true,
                  "enablePurgeProtection": true,
                  "networkAcls": {
                    "bypass": "AzureServices",
                    "defaultAction": "Deny"
                  },
                  "sku": {
                    "family": "A",
                    "name": "standard"
                  },
                  "softDeleteRetentionInDays": 7,
                  "tenantId": "[subscription().tenantId]"
                }
              },
              {
                "type": "Microsoft.CognitiveServices/accounts",
                "apiVersion": "2021-10-01",
                "name": "[parameters('aiServicesName')]",
                "location": "[parameters('location')]",
                "sku": {
                  "name": "S0"
                },
                "kind": "AIServices",
                "properties": {
                  "apiProperties": {
                    "statisticsEnabled": false
                  }
                }
              },
              {
                "type": "Microsoft.Storage/storageAccounts",
                "apiVersion": "2022-09-01",
                "name": "[variables('storageNameCleaned')]",
                "location": "[parameters('location')]",
                "tags": "[parameters('tags')]",
                "sku": {
                  "name": "[parameters('storageSkuName')]"
                },
                "kind": "StorageV2",
                "properties": {
                  "accessTier": "Hot",
                  "allowBlobPublicAccess": true,
                  "allowCrossTenantReplication": false,
                  "allowSharedKeyAccess": true,
                  "encryption": {
                    "keySource": "Microsoft.Storage",
                    "requireInfrastructureEncryption": false,
                    "services": {
                      "blob": {
                        "enabled": true,
                        "keyType": "Account"
                      },
                      "file": {
                        "enabled": true,
                        "keyType": "Account"
                      },
                      "queue": {
                        "enabled": true,
                        "keyType": "Service"
                      },
                      "table": {
                        "enabled": true,
                        "keyType": "Service"
                      }
                    }
                  },
                  "isHnsEnabled": false,
                  "isNfsV3Enabled": false,
                  "keyPolicy": {
                    "keyExpirationPeriodInDays": 7
                  },
                  "largeFileSharesState": "Disabled",
                  "minimumTlsVersion": "TLS1_2",
                  "networkAcls": {
                    "bypass": "AzureServices",
                    "defaultAction": "Allow"
                  },
                  "supportsHttpsTrafficOnly": true
                }
              }
            ],
            "outputs": {
              "aiservicesID": {
                "type": "string",
                "value": "[resourceId('Microsoft.CognitiveServices/accounts', parameters('aiServicesName'))]"
              },
              "aiservicesTarget": {
                "type": "string",
                "value": "[reference(resourceId('Microsoft.CognitiveServices/accounts', parameters('aiServicesName')), '2021-10-01').endpoint]"
              },
              "storageId": {
                "type": "string",
                "value": "[resourceId('Microsoft.Storage/storageAccounts', variables('storageNameCleaned'))]"
              },
              "keyvaultId": {
                "type": "string",
                "value": "[resourceId('Microsoft.KeyVault/vaults', parameters('keyvaultName'))]"
              },
              "containerRegistryId": {
                "type": "string",
                "value": "[resourceId('Microsoft.ContainerRegistry/registries', variables('containerRegistryNameCleaned'))]"
              },
              "applicationInsightsId": {
                "type": "string",
                "value": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
              }
            }
          }
        }
      },
      {
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2022-09-01",
        "name": "[format('ai-{0}-deployment', parameters('aiHubName'))]",
        "properties": {
          "expressionEvaluationOptions": {
            "scope": "inner"
          },
          "mode": "Incremental",
          "parameters": {
            "aiHubName": {
              "value": "[format('ai-{0}-{1}', parameters('aiHubName'), variables('uniqueSuffix'))]"
            },
            "aiHubFriendlyName": {
              "value": "[parameters('aiHubFriendlyName')]"
            },
            "aiHubDescription": {
              "value": "[parameters('aiHubDescription')]"
            },
            "location": {
              "value": "[parameters('location')]"
            },
            "tags": {
              "value": "[parameters('tags')]"
            },
            "keyVaultId": {
              "value": "[reference(resourceId('Microsoft.Resources/deployments', format('dependencies-{0}-{1}-deployment', variables('name'), variables('uniqueSuffix'))), '2022-09-01').outputs.keyvaultId.value]"
            },
            "storageAccountId": {
              "value": "[reference(resourceId('Microsoft.Resources/deployments', format('dependencies-{0}-{1}-deployment', variables('name'), variables('uniqueSuffix'))), '2022-09-01').outputs.storageId.value]"
            },
            "computeInstanceName": {
              "value": "[parameters('computeInstanceName')]"
            }
          },
          "template": {
            "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
            "contentVersion": "1.0.0.0",
            "metadata": {
              "_generator": {
                "name": "bicep",
                "version": "0.26.54.24096",
                "templateHash": "3681216872761074759"
              }
            },
            "parameters": {
              "location": {
                "type": "string",
                "metadata": {
                  "description": "Azure region of the deployment"
                }
              },
              "tags": {
                "type": "object",
                "metadata": {
                  "description": "Tags to add to the resources"
                }
              },
              "aiHubName": {
                "type": "string",
                "metadata": {
                  "description": "AI hub name"
                }
              },
              "aiHubFriendlyName": {
                "type": "string",
                "defaultValue": "[parameters('aiHubName')]",
                "metadata": {
                  "description": "AI hub display name"
                }
              },
              "aiHubDescription": {
                "type": "string",
                "metadata": {
                  "description": "AI hub description"
                }
              },
              "keyVaultId": {
                "type": "string",
                "metadata": {
                  "description": "Resource ID of the key vault resource for storing connection strings"
                }
              },
              "storageAccountId": {
                "type": "string",
                "metadata": {
                  "description": "Resource ID of the storage account resource for storing experimentation outputs"
                }
              },
              "computeInstanceName": {
                "type": "string",
                "metadata": {
                  "description": "Specifies the name of the Compute Instance to create under Azure Machine Learning workspace."
                }
              },
              "vmSize": {
                "type": "string",
                "defaultValue": "Standard_DS11_v2",
                "allowedValues": [
                  "A1_v2",
                  "A2_v2",
                  "A4_v2",
                  "A8_v2",
                  "A2m_v2",
                  "A4m_v2",
                  "A8m_v2",
                  "Basic_A0",
                  "Basic_A1",
                  "Basic_A2",
                  "Basic_A3",
                  "Basic_A4",
                  "Standard_A0",
                  "Standard_A1",
                  "Standard_A2",
                  "Standard_A1_v2",
                  "Standard_A2_v2",
                  "Standard_A2m_v2",
                  "Standard_A3",
                  "Standard_A4",
                  "Standard_A4_v2",
                  "Standard_A4m_v2",
                  "Standard_A5",
                  "Standard_A6",
                  "Standard_A7",
                  "Standard_A8_v2",
                  "Standard_A8m_v2",
                  "Standard_D1",
                  "Standard_D2",
                  "Standard_D3",
                  "Standard_D4",
                  "Standard_D2_v3",
                  "Standard_D4_v3",
                  "Standard_D8_v3",
                  "Standard_D16_v3",
                  "Standard_D32_v3",
                  "Standard_D64_v3",
                  "Standard_D2s_v3",
                  "Standard_D4s_v3",
                  "Standard_D8s_v3",
                  "Standard_D16s_v3",
                  "Standard_D32-16s_v3",
                  "Standard_D32-8s_v3",
                  "Standard_D32s_v3",
                  "Standard_D64s_v3",
                  "Standard_D64-32s_v3",
                  "Standard_D64-16s_v3",
                  "Standard_D1_v2",
                  "Standard_D2_v2",
                  "Standard_D2_v2_Promo",
                  "Standard_D3_v2",
                  "Standard_D3_v2_Promo",
                  "Standard_D4_v2",
                  "Standard_D4_v2_Promo",
                  "Standard_D5_v2",
                  "Standard_D5_v2_Promo",
                  "Standard_DS1_v2",
                  "Standard_DS2",
                  "Standard_DS2_v2",
                  "Standard_DS2_v2_Promo",
                  "Standard_DS3",
                  "Standard_DS3_v2",
                  "Standard_DS3_v2_Promo",
                  "Standard_DS4",
                  "Standard_DS4_v2",
                  "Standard_DS4_v2_Promo",
                  "Standard_DS5",
                  "Standard_DS5_v2",
                  "Standard_DS5_v2_Promo",
                  "Standard_B1ls",
                  "Standard_B1ms",
                  "Standard_B1s",
                  "Standard_B2ms",
                  "Standard_B2s",
                  "Standard_B4ms",
                  "Standard_B8ms",
                  "Standard_D48_v3",
                  "Standard_D48s_v3",
                  "Standard_B12ms",
                  "Standard_B16ms",
                  "Standard_B20ms",
                  "Standard_D2_v4",
                  "Standard_D2d_v4",
                  "Standard_D2ds_v4",
                  "Standard_D4_v4",
                  "Standard_D8_v4",
                  "Standard_D16_v4",
                  "Standard_D32_v4",
                  "Standard_D32d_v4",
                  "Standard_D32ds_v4",
                  "Standard_D48_v4",
                  "Standard_D64_v4",
                  "Standard_D2s_v4",
                  "Standard_D4s_v4",
                  "Standard_D8s_v4",
                  "Standard_D16s_v4",
                  "Standard_D32s_v4",
                  "Standard_D48s_v4",
                  "Standard_D64s_v4",
                  "Standard_D2as_v4",
                  "Standard_D2a_v4",
                  "Standard_D4as_v4",
                  "Standard_D4a_v4",
                  "Standard_D4d_v4",
                  "Standard_D4ds_v4",
                  "Standard_D8as_v4",
                  "Standard_D8a_v4",
                  "Standard_D8ds_v4",
                  "Standard_D8d_v4",
                  "Standard_D16a_v4",
                  "Standard_D16as_v4",
                  "Standard_D16d_v4",
                  "Standard_D16ds_v4",
                  "Standard_D32a_v4",
                  "Standard_D32as_v4",
                  "Standard_D48a_v4",
                  "Standard_D48as_v4",
                  "Standard_D48d_v4",
                  "Standard_D48ds_v4",
                  "Standard_D64a_v4",
                  "Standard_D64as_v4",
                  "Standard_D64d_v4",
                  "Standard_D64ds_v4",
                  "Standard_D96a_v4",
                  "Standard_D96as_v4",
                  "Experimental_D2ns_v4",
                  "Experimental_D4ns_v4",
                  "Experimental_D8ns_v4",
                  "Experimental_D16ns_v4",
                  "Experimental_D32ns_v4",
                  "Experimental_D48ns_v2",
                  "Experimental_D64ns_v2",
                  "Standard_A8",
                  "Standard_A9",
                  "Standard_A10",
                  "Standard_A11",
                  "Standard_F1",
                  "Standard_F2",
                  "Standard_F4",
                  "Standard_F8",
                  "Standard_F16",
                  "Standard_F1s",
                  "Standard_F2s",
                  "Standard_F4s",
                  "Standard_F8s",
                  "Standard_F16s",
                  "Standard_F2s_v2",
                  "Standard_F4s_v2",
                  "Standard_F8s_v2",
                  "Standard_F16s_v2",
                  "Standard_F32s_v2",
                  "Standard_F64s_v2",
                  "Standard_F72s_v2",
                  "Standard_F48s_v2",
                  "Experimental_F2ns_v2",
                  "Experimental_F4ns_v2",
                  "Experimental_F8ns_v2",
                  "Experimental_F16ns_v2",
                  "Experimental_F32ns_v2",
                  "Experimental_F48ns_v2",
                  "Experimental_F64ns_v2",
                  "Experimental_F72ns_v2",
                  "Standard_D11",
                  "Standard_D12",
                  "Standard_D13",
                  "Standard_D14",
                  "Standard_E2_v3",
                  "Standard_E4_v3",
                  "Standard_E80ids_v4",
                  "Standard_E80is_v4",
                  "Standard_E8_v3",
                  "Standard_E16_v3",
                  "Standard_E32_v3",
                  "Standard_E64_v3",
                  "Standard_E64i_v3",
                  "Standard_E2s_v3",
                  "Standard_E4s_v3",
                  "Standard_E4-2as_v4",
                  "Standard_E4-2ds_v4",
                  "Standard_E4-2s_v3",
                  "Standard_E8s_v3",
                  "Standard_E8-4as_v4",
                  "Standard_E8-4ds_v4",
                  "Standard_E8-4s_v3",
                  "Standard_E8-2as_v4",
                  "Standard_E8-2ds_v4",
                  "Standard_E8-2d_v4",
                  "Standard_E8-2s_v3",
                  "Standard_E16s_v3",
                  "Standard_E16-8as_v4",
                  "Standard_E16-8ds_v4",
                  "Standard_E16-8s_v3",
                  "Standard_E16-4as_v4",
                  "Standard_E16-4ds_v4",
                  "Standard_E16-4s_v3",
                  "Standard_E20_v3",
                  "Standard_E20s_v3",
                  "Standard_E32s_v3",
                  "Standard_E32-16as_v4",
                  "Standard_E32-16ds_v4",
                  "Standard_E32-16s_v3",
                  "Standard_E32-8as_v4",
                  "Standard_E32-8ds_v4",
                  "Standard_E32-8s_v3",
                  "Standard_E64s_v3",
                  "Standard_E64is_v3",
                  "Standard_E64-32as_v4",
                  "Standard_E64-32ds_v4",
                  "Standard_E64-32s_v3",
                  "Standard_E64-16s_v3",
                  "Standard_D11_v2",
                  "Standard_D11_v2_Promo",
                  "Standard_D12_v2",
                  "Standard_D12_v2_Promo",
                  "Standard_D13_v2",
                  "Standard_D13_v2_Promo",
                  "Standard_D14_v2_Promo",
                  "Standard_D14_v2",
                  "Standard_D15_v2",
                  "Standard_DS11",
                  "Standard_DS11_v2",
                  "Standard_DS11_v2_Promo",
                  "Standard_DS11-1_v2",
                  "Standard_DS12",
                  "Standard_DS12_v2",
                  "Standard_DS12_v2_Promo",
                  "Standard_DS12-1_v2",
                  "Standard_DS12-2_v2",
                  "Standard_DS13",
                  "Standard_DS13_v2",
                  "Standard_DS13_v2_Promo",
                  "Standard_DS13-2_v2",
                  "Standard_DS13-4_v2",
                  "Standard_DS14",
                  "Standard_DS14_v2",
                  "Standard_DS14_v2_Promo",
                  "Standard_DS14-8_v2",
                  "Standard_DS14-4_v2",
                  "Standard_DS15_v2",
                  "Special_CCX_DS13_v2",
                  "Special_CCX_DS14_v2",
                  "Standard_G1",
                  "Standard_G2",
                  "Standard_G3",
                  "Standard_G4",
                  "Standard_G5",
                  "Standard_GS1",
                  "Standard_GS2",
                  "Standard_GS3",
                  "Standard_GS4",
                  "Standard_GS4-8",
                  "Standard_GS4-4",
                  "Standard_GS5",
                  "Standard_GS5-16",
                  "Standard_GS5-8",
                  "Standard_M8ms",
                  "Standard_M8-4ms",
                  "Standard_M8-2ms",
                  "Standard_M16ms",
                  "Standard_M16-8ms",
                  "Standard_M16-4ms",
                  "Standard_M32ms",
                  "Standard_M32-16ms",
                  "Standard_M32-8ms",
                  "Standard_M64",
                  "Standard_M64m",
                  "Standard_M64s",
                  "Standard_M64ms",
                  "Standard_M64-32ms",
                  "Standard_M64-16ms",
                  "Standard_M128",
                  "Standard_M128m",
                  "Standard_M128s",
                  "Standard_M128ms",
                  "Standard_M128-64ms",
                  "Standard_M128-32ms",
                  "Standard_M64ls",
                  "Standard_M32ls",
                  "Standard_M32ts",
                  "Standard_E32-16_v3",
                  "Standard_E32-8_v3",
                  "Standard_E64-32_v3",
                  "Standard_E64-16_v3",
                  "Standard_D32-16_v3",
                  "Standard_D32-8_v3",
                  "Standard_D64-32_v3",
                  "Standard_D64-16_v3",
                  "Standard_E48_v3",
                  "Standard_E48s_v3",
                  "Standard_M416-208ms_v2",
                  "Standard_M416-208s_v2",
                  "Standard_M416s_v2",
                  "Standard_M416ms_v2",
                  "Standard_M208s_v2",
                  "Standard_M208ms_v2",
                  "Standard_D15i_v2",
                  "Standard_DS15i_v2",
                  "Standard_E2_v4",
                  "Standard_E4_v4",
                  "Standard_E8_v4",
                  "Standard_E16_v4",
                  "Standard_E20_v4",
                  "Standard_E32_v4",
                  "Standard_E48_v4",
                  "Standard_E64_v4",
                  "Standard_E2s_v4",
                  "Standard_E4s_v4",
                  "Standard_E8s_v4",
                  "Standard_E16s_v4",
                  "Standard_E20s_v4",
                  "Standard_E32s_v4",
                  "Standard_E48s_v4",
                  "Standard_E64s_v4",
                  "Standard_E64is_v4_SPECIAL",
                  "Standard_E4-2s_v4",
                  "Standard_E8-4s_v4",
                  "Standard_E8-2s_v4",
                  "Standard_E16-8s_v4",
                  "Standard_E16-4s_v4",
                  "Standard_E32-16s_v4",
                  "Standard_E32-8s_v4",
                  "Standard_E64-32s_v4",
                  "Standard_E64-16as_v4",
                  "Standard_E64-16ds_v4",
                  "Standard_E64-16s_v4",
                  "Standard_E2as_v4",
                  "Standard_E2a_v4",
                  "Standard_E2ds_v4",
                  "Standard_E2d_v4",
                  "Standard_E4as_v4",
                  "Standard_E4d_v4",
                  "Standard_E4ds_v4",
                  "Standard_E4a_v4",
                  "Standard_E8as_v4",
                  "Standard_E8d_v4",
                  "Standard_E8ds_v4",
                  "Standard_E8a_v4",
                  "Standard_E16as_v4",
                  "Standard_E16a_v4",
                  "Standard_E16d_v4",
                  "Standard_E16ds_v4",
                  "Standard_E20as_v4",
                  "Standard_E20a_v4",
                  "Standard_E20d_v4",
                  "Standard_E20ds_v4",
                  "Standard_E32as_v4",
                  "Standard_E32d_v4",
                  "Standard_E32ds_v4",
                  "Standard_E32a_v4",
                  "Standard_E48a_v4",
                  "Standard_E48as_v4",
                  "Standard_E48d_v4",
                  "Standard_E48ds_v4",
                  "Standard_E64a_v4",
                  "Standard_E64as_v4",
                  "Standard_E64d_v4",
                  "Standard_E64ds_v4",
                  "Standard_E96-24as_v4",
                  "Standard_E96-48as_v4",
                  "Standard_E96a_v4",
                  "Standard_E96as_v4",
                  "Experimental_E2ns_v4",
                  "Experimental_E4ns_v4",
                  "Experimental_E8ns_v4",
                  "Experimental_E16ns_v4",
                  "Experimental_E32ns_v4",
                  "Experimental_E48ns_v4",
                  "Experimental_E64ns_v4",
                  "Standard_L4s",
                  "Standard_L8s",
                  "Standard_L16s",
                  "Standard_L32s",
                  "Standard_L8s_v2",
                  "Standard_L16s_v2",
                  "Standard_L32s_v2",
                  "Standard_L64s_v2",
                  "Standard_L48s_v2",
                  "Standard_L80s_v2",
                  "Standard_DC1s_v2",
                  "Standard_DC2s_v2",
                  "Standard_DC4s_v2",
                  "Standard_DC8_v2",
                  "Standard_NV6",
                  "Standard_NV12",
                  "Standard_NV24",
                  "Standard_NC6",
                  "Standard_NC12",
                  "Standard_NC24",
                  "Standard_NC24r",
                  "Standard_NC6s_v2",
                  "Standard_NC12s_v2",
                  "Standard_NC24s_v2",
                  "Standard_NC24rs_v2",
                  "Standard_NC6s_v3",
                  "Standard_NC12s_v3",
                  "Standard_NC24s_v3",
                  "Standard_NC24rs_v3",
                  "Standard_ND6s",
                  "Standard_ND12s",
                  "Standard_ND24s",
                  "Standard_ND24rs",
                  "Standard_ND40s_v2",
                  "Standard_NV6s_v2",
                  "Standard_NV12s_v2",
                  "Standard_NV24s_v2",
                  "Standard_NV24_Promo",
                  "Standard_NV12_Promo",
                  "Standard_NV6_Promo",
                  "Standard_NC24r_Promo",
                  "Standard_NC24_Promo",
                  "Standard_NC12_Promo",
                  "Standard_NC6_Promo",
                  "Standard_NV12s_v3",
                  "Standard_NV24s_v3",
                  "Standard_NV48s_v3",
                  "Standard_ND40rs_v2",
                  "Standard_NV4as_v4",
                  "Standard_NV8as_v4",
                  "Standard_NV16as_v4",
                  "Standard_NV32as_v4",
                  "Standard_NV24ms_v3",
                  "Standard_NV32ms_v3",
                  "Standard_NC4as_T4_v3",
                  "Standard_NC8as_T4_v3",
                  "Standard_NC16as_T4_v3",
                  "Standard_NC64as_T4_v3",
                  "Standard_H8",
                  "Standard_H8m",
                  "Standard_H16",
                  "Standard_H16m",
                  "Standard_H16r",
                  "Standard_H16mr",
                  "Standard_H16r_Promo",
                  "Standard_H16mr_Promo",
                  "Standard_H16m_Promo",
                  "Standard_H16_Promo",
                  "Standard_H8m_Promo",
                  "Standard_H8_Promo",
                  "Standard_HC44rs",
                  "Standard_HB60rs",
                  "Standard_HB120rs_v2"
                ],
                "metadata": {
                  "description": "Specifies the VM size of the Compute Instance to create under Azure Machine Learning workspace."
                }
              }
            },
            "resources": [
              {
                "type": "Microsoft.MachineLearningServices/workspaces/computes",
                "apiVersion": "2023-10-01",
                "name": "[format('{0}/{1}', parameters('aiHubName'), parameters('computeInstanceName'))]",
                "location": "[parameters('location')]",
                "tags": "[parameters('tags')]",
                "identity": {
                  "type": "SystemAssigned"
                },
                "properties": {
                  "computeType": "ComputeInstance",
                  "computeLocation": "[parameters('location')]",
                  "description": "Machine Learning compute instance 001",
                  "properties": {
                    "applicationSharingPolicy": "Personal",
                    "computeInstanceAuthorizationType": "personal",
                    "sshSettings": {
                      "sshPublicAccess": "Enabled"
                    },
                    "vmSize": "[parameters('vmSize')]",
                    "enableNodePublicIp": true
                  }
                },
                "dependsOn": [
                  "[resourceId('Microsoft.MachineLearningServices/workspaces', parameters('aiHubName'))]"
                ]
              },
              {
                "type": "Microsoft.MachineLearningServices/workspaces",
                "apiVersion": "2023-08-01-preview",
                "name": "[parameters('aiHubName')]",
                "location": "[parameters('location')]",
                "tags": "[parameters('tags')]",
                "identity": {
                  "type": "SystemAssigned"
                },
                "properties": {
                  "friendlyName": "[parameters('aiHubFriendlyName')]",
                  "description": "[parameters('aiHubDescription')]",
                  "keyVault": "[parameters('keyVaultId')]",
                  "storageAccount": "[parameters('storageAccountId')]"
                },
                "kind": "hub"
              }
            ],
            "outputs": {
              "aiHubID": {
                "type": "string",
                "value": "[resourceId('Microsoft.MachineLearningServices/workspaces', parameters('aiHubName'))]"
              }
            }
          }
        },
        "dependsOn": [
          "[resourceId('Microsoft.Resources/deployments', format('dependencies-{0}-{1}-deployment', variables('name'), variables('uniqueSuffix')))]"
        ]
      },
      {
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2022-09-01",
        "name": "[format('ai-{0}-deployment', parameters('aiProjectName'))]",
        "properties": {
          "expressionEvaluationOptions": {
            "scope": "inner"
          },
          "mode": "Incremental",
          "parameters": {
            "aiHubDescription": {
              "value": "[parameters('aiProjectDescription')]"
            },
            "aiProjectFriendlyName": {
              "value": "[parameters('aiProjectFriendlyName')]"
            },
            "aiProjectName": {
              "value": "[format('ai-{0}-{1}', parameters('aiProjectName'), variables('uniqueSuffix'))]"
            },
            "location": {
              "value": "[parameters('location')]"
            },
            "tags": {
              "value": "[parameters('tags')]"
            },
            "aiHubID": {
              "value": "[reference(resourceId('Microsoft.Resources/deployments', format('ai-{0}-deployment', parameters('aiHubName'))), '2022-09-01').outputs.aiHubID.value]"
            }
          },
          "template": {
            "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
            "contentVersion": "1.0.0.0",
            "metadata": {
              "_generator": {
                "name": "bicep",
                "version": "0.26.54.24096",
                "templateHash": "1461486837368608056"
              }
            },
            "parameters": {
              "location": {
                "type": "string",
                "metadata": {
                  "description": "Azure region of the deployment"
                }
              },
              "tags": {
                "type": "object",
                "metadata": {
                  "description": "Tags to add to the resources"
                }
              },
              "aiProjectName": {
                "type": "string",
                "metadata": {
                  "description": "AI hub name"
                }
              },
              "aiProjectFriendlyName": {
                "type": "string",
                "metadata": {
                  "description": "AI hub display name"
                }
              },
              "aiHubDescription": {
                "type": "string",
                "metadata": {
                  "description": "AI hub description"
                }
              },
              "aiHubID": {
                "type": "string",
                "metadata": {
                  "description": "Resource ID of the AI Services Hub"
                }
              }
            },
            "resources": [
              {
                "type": "Microsoft.MachineLearningServices/workspaces",
                "apiVersion": "2023-08-01-preview",
                "name": "[parameters('aiProjectName')]",
                "location": "[parameters('location')]",
                "tags": "[parameters('tags')]",
                "identity": {
                  "type": "SystemAssigned"
                },
                "properties": {
                  "friendlyName": "[parameters('aiProjectFriendlyName')]",
                  "description": "[parameters('aiHubDescription')]",
                  "hubResourceId": "[parameters('aiHubID')]"
                },
                "kind": "project"
              }
            ],
            "outputs": {
              "aiProjectID": {
                "type": "string",
                "value": "[resourceId('Microsoft.MachineLearningServices/workspaces', parameters('aiProjectName'))]"
              }
            }
          }
        },
        "dependsOn": [
          "[resourceId('Microsoft.Resources/deployments', format('ai-{0}-deployment', parameters('aiHubName')))]"
        ]
      }
    ]
  }